# Web

## プロキシ（Proxy）

| 項目 | 値 |
|------|----|
| 理解度 | ▪︎▪︎◻︎◻︎ |
| 保存日 | 2026-02-23 |
| 最終復習 | 2026-02-26 |
| 次回復習 | 2026-03-01 |

**Q:** プロキシとはどういう概念か？

**A:** 「代理人」を意味し、クライアントと本来のリソースの間に割り込んで処理を中継するもの。リクエストを検査・判断・転送する役割を持つ。

**メモ:** 現実の「受付」が来訪者と担当者の間に立つのと同じ構造。Web開発では認証チェック（未ログイン→リダイレクト）、キャッシュ、ロードバランサー、VPNなど「間に入って何か処理してから転送する」もの全般を指す。Next.jsの `middleware.ts` が認証ガードとして機能するのもこのパターン。

フレームワークによって呼び名は異なるが、すべて同じプロキシパターンの実装:
- Rails: `before_action`（ログイン済みチェックなど）
- Spring: `Filter` / `HandlerInterceptor`
- Express: `app.use(fn)`
- Next.js: `middleware.ts`

## `visibilitychange` イベント

| 項目 | 値 |
|------|----|
| 理解度 | ▪︎◻︎◻︎◻︎ |
| 保存日 | 2026-02-26 |
| 最終復習 | 2026-02-26 |
| 次回復習 | 2026-02-27 |

**Q:** `visibilitychange` イベントとは何か？どんなときに使うか？

**A:** タブ・ウィンドウの表示状態が変わったときに `document` で発火するイベント。`document.visibilityState` が `"visible"` / `"hidden"` になるタイミングで検知できる。動画の自動停止、タイマー制御、ポーリングの停止・再開などに使う。

## bfcache（Back/Forward Cache）

| 項目 | 値 |
|------|----|
| 理解度 | ▪︎▪︎◻︎◻︎ |
| 保存日 | 2026-02-26 |
| 最終復習 | 2026-02-27 |
| 次回復習 | 2026-03-02 |

**Q:** bfcache とは何か？何が問題になるか？

**A:** ブラウザがページをメモリにまるごとスナップショット保存する最適化機能。戻る/進む操作や、iOS Safari でのタブ復帰時にページを再リクエストせず即復元する。`pageshow` イベントの `event.persisted === true` で検知できる。

**メモ:** 再リクエストが走らないためトークンリフレッシュが実行されず、認証切れが検知されないことがある。`sessionStorage` のフラグも bfcache 復元時に一緒に復元されるため、「一度だけ実行」の制御に使えない。

## サーバーレンダリング vs クライアントレンダリング

| 項目 | 値 |
|------|----|
| 理解度 | ▪︎◻︎◻︎◻︎ |
| 保存日 | 2026-02-26 |
| 最終復習 | 2026-02-26 |
| 次回復習 | 2026-02-27 |

**Q:** サーバーレンダリングとクライアントレンダリングの違いと、それぞれの利点は？

**A:**
- **クライアントレンダリング（CSR）**: 空の HTML + JS をブラウザに送り、ブラウザがコンテンツを生成。JS 実行まで表示されない。
- **サーバーレンダリング（SSR）**: サーバーが DB からデータ取得 → HTML 生成 → 完成した HTML を送る。表示が速く、DB アクセスキーがサーバーから出ないため安全。

**メモ:** Rails は常にサーバーレンダリング。従来の React は CSR。Next.js の RSC は1ページ内で混在可能（静的な表示はサーバー、クリックなど動く部分はクライアント）。`router.refresh()` は RSC の差分だけを再取得するリクエスト。
